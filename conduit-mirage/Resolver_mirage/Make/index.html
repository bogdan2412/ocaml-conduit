<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Make (conduit-mirage.Resolver_mirage.Make)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.4"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">conduit-mirage</a> &#x00BB; <a href="../index.html">Resolver_mirage</a> &#x00BB; Make</nav><header class="odoc-preamble"><h1>Module <code><span>Resolver_mirage.Make</span></code></h1><p>Provides a DNS-enabled <a href="../../../conduit-lwt/Resolver_lwt/index.html"><code>Resolver_lwt</code></a> given a network stack.</p></header><nav class="odoc-toc"><ul><li><a href="#parameters">Parameters</a></li><li><a href="#signature">Signature</a></li></ul></nav><div class="odoc-content"><h2 id="parameters"><a href="#parameters" class="anchor"></a>Parameters</h2><div class="odoc-spec"><div class="spec parameter anchored" id="argument-1-S"><a href="#argument-1-S" class="anchor"></a><code><span><span class="keyword">module</span> </span><span>S</span><span> : <span class="xref-unresolved">Tcpip</span>.Stack.V4V6</span></code></div></div><h2 id="signature"><a href="#signature" class="anchor"></a>Signature</h2><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="../module-type-S/index.html">S</a></span></code></summary><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="../../../conduit-lwt/Resolver_lwt/module-type-S/index.html">Resolver_lwt.S</a></span></code></summary><div class="odoc-spec"><div class="spec type anchored" id="type-io"><a href="#type-io" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a io</span></span><span> = <span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Abstract type of the cooperative threading library used, normally defined via the <code>IO</code> module type</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>State handle for a running resolver</p></div></div><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <span class="xref-unresolved">Sexplib0</span>.Sexpable.S <span class="keyword">with</span> <span><span class="keyword">type</span> <span class="xref-unresolved">t</span> := <span class="xref-unresolved">t</span></span></span></code></summary><div class="odoc-spec"><div class="spec value anchored" id="val-t_of_sexp"><a href="#val-t_of_sexp" class="anchor"></a><code><span><span class="keyword">val</span> t_of_sexp : <span><span class="xref-unresolved">Sexplib0__</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sexp_of_t"><a href="#val-sexp_of_t" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_t : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Sexplib0__</span>.Sexp.t</span></code></div></div></details></div><div class="odoc-spec"><div class="spec type anchored" id="type-svc"><a href="#type-svc" class="anchor"></a><code><span><span class="keyword">type</span> svc</span><span> = <a href="../../../conduit/Resolver/index.html#type-service">Resolver.service</a></span></code></div><div class="spec-doc"><p>Abstract type for a service entry, which maps a URI scheme into a protocol handler and TCP port</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-sexp_of_svc"><a href="#val-sexp_of_svc" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_svc : <span><a href="#type-svc">svc</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Sexplib0</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-svc_of_sexp"><a href="#val-svc_of_sexp" class="anchor"></a><code><span><span class="keyword">val</span> svc_of_sexp : <span><span class="xref-unresolved">Sexplib0</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <a href="#type-svc">svc</a></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-rewrite_fn"><a href="#type-rewrite_fn" class="anchor"></a><code><span><span class="keyword">type</span> rewrite_fn</span><span> = <span><a href="#type-svc">svc</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Uri</span>.t <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../conduit/Conduit/index.html#type-endp">Conduit.endp</a> <a href="#type-io">io</a></span></span></code></div><div class="spec-doc"><p>A rewrite function resolves a <a href="#type-svc" title="svc">service</a> and a URI into a concrete endpoint.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-service_fn"><a href="#type-service_fn" class="anchor"></a><code><span><span class="keyword">type</span> service_fn</span><span> = <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-svc">svc</a> option</span> <a href="#type-io">io</a></span></span></code></div><div class="spec-doc"><p>A service function maps the string (such as <code>http</code> or <code>ftp</code>) from a URI scheme into a <a href="#type-svc" title="svc">service</a> description that includes enough metadata about the service to subsequently <a href="#type-rewrite_fn" title="rewrite_fn">resolve</a> it into an <span class="xref-unresolved" title="endp">endpoint</span>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(++)"><a href="#val-(++)" class="anchor"></a><code><span><span class="keyword">val</span> (++) : <span><a href="#type-service_fn">service_fn</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-service_fn">service_fn</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-service_fn">service_fn</a></span></code></div><div class="spec-doc"><p><code>f ++ g</code> is the composition of the service functions <code>f</code> and <code>g</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-init"><a href="#val-init" class="anchor"></a><code><span><span class="keyword">val</span> init : 
  <span><span class="optlabel">?service</span>:<a href="#type-service_fn">service_fn</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?rewrites</span>:<span><span>(string * <a href="#type-rewrite_fn">rewrite_fn</a>)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>init ?service ?rewrites</code> will initialize the resolver and return a state handler. The <a href="#type-service_fn" title="service_fn">service</a> argument should contain the system-specific resolution mechanism for URI schemas.</p><p>The <code>rewrites</code> argument can optionally override a subset of the URI domain name with the given <a href="#type-rewrite_fn"><code>rewrite_fn</code></a> to permit custom resolution rules. For example, a rewrite rule for &quot;.xen&quot; would let the rewrite function resolve hostnames such as &quot;foo.xen&quot; into a shared memory channel for the &quot;foo&quot; virtual machine.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_rewrite"><a href="#val-add_rewrite" class="anchor"></a><code><span><span class="keyword">val</span> add_rewrite : <span><span class="label">host</span>:string <span class="arrow">&#45;&gt;</span></span> <span><span class="label">f</span>:<a href="#type-rewrite_fn">rewrite_fn</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>add_rewrite ~host f t</code> will add to the <code>t</code> resolver the <code>f</code> rewrite rule for all the domain names that shortest-prefix match <code>host</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_service"><a href="#val-set_service" class="anchor"></a><code><span><span class="keyword">val</span> set_service : <span><span class="label">f</span>:<a href="#type-service_fn">service_fn</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-service"><a href="#val-service" class="anchor"></a><code><span><span class="keyword">val</span> service : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-service_fn">service_fn</a></span></code></div><div class="spec-doc"><p><code>service t</code> is the function which is called when trying to resolve a hostname with <code>t</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-resolve_uri"><a href="#val-resolve_uri" class="anchor"></a><code><span><span class="keyword">val</span> resolve_uri : 
  <span><span class="optlabel">?rewrites</span>:<span><span>(string * <a href="#type-rewrite_fn">rewrite_fn</a>)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">uri</span>:<span class="xref-unresolved">Uri</span>.t <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../../conduit/Conduit/index.html#type-endp">Conduit.endp</a> <a href="#type-io">io</a></span></span></code></div><div class="spec-doc"><p><code>resolve_uri ?rewrites ~uri t</code> will use <code>t</code> to resolve the <code>uri</code> into a concrete endpoint. Any <code>rewrites</code> that are passed in will be overlayed on the existing rules within the <code>t</code> resolver, but not otherwise modify it.</p></div></div></details></div><div class="odoc-spec"><div class="spec value anchored" id="val-static"><a href="#val-static" class="anchor"></a><code><span><span class="keyword">val</span> static : <span><span><span>(string, <span><span class="label">port</span>:int <span class="arrow">&#45;&gt;</span></span> <a href="../../../conduit/Conduit/index.html#type-endp">Conduit.endp</a>)</span> <span class="xref-unresolved">Stdlib</span>.Hashtbl.t</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>static hosts</code> constructs a resolver that looks up any resolution requests from the static <code>hosts</code> hashtable instead of using the system resolver.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-localhost"><a href="#val-localhost" class="anchor"></a><code><span><span class="keyword">val</span> localhost : <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>localhost</code> is a static resolver that has a single entry that maps <code>localhost</code> to <code>127.0.0.1</code>, and fails on all other hostnames.</p></div></div></details></div><div class="odoc-spec"><div class="spec value anchored" id="val-v"><a href="#val-v" class="anchor"></a><code><span><span class="keyword">val</span> v : 
  <span><span class="optlabel">?nameservers</span>:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">S</span>.t <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<a href="#type-t">t</a>, <span>[&gt; <span>`Msg of string</span> ]</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>v ~nameservers stack ()</code> TODO. An error is returned if any of the nameserver specifications do not parse.</p></div></div></div></body></html>
